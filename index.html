<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ナチュリズム × Kep1er キャンペーン店舗検索</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel Standalone for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        body {
            font-family: 'Meiryo', sans-serif;
        }
        
        /* スムーズなフェードインアニメーション */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fade-in-up {
            animation: fadeInUp 0.8s ease-out forwards;
            opacity: 0;
        }
        
        /* キラキラアニメーション */
        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0) rotate(0deg); }
            50% { opacity: 1; transform: scale(1) rotate(180deg); }
        }
        
        .sparkle-animation {
            animation: sparkle 2s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // ========================================
        // ⚠️ 重要: ここにGitHub GistのRaw URLを設定してください
        // ========================================
        const GITHUB_GIST_URL = 'https://gist.githubusercontent.com/katsuar55/a3b31c943e12a13b22a8e0441209f9c0/raw/donki-stores.json';
        
        // アイコンコンポーネント
        const Icon = ({ name, className }) => {
            useEffect(() => {
                lucide.createIcons();
            }, []);
            return <i data-lucide={name} className={className}></i>;
        };
        
        // 郵便番号→座標マッピング
        const getLatLngFromPostalCode = (postalCode) => {
            const prefix = postalCode.substring(0, 3);
            const mapping = {
                // 北海道
                '001': [43.08, 141.38], '002': [43.10, 141.36], '003': [43.05, 141.41],
                '004': [43.03, 141.47], '005': [43.06, 141.40], '060': [43.06, 141.35],
                '040': [41.77, 140.73], '050': [42.98, 141.61],
                // 東京都
                '100': [35.68, 139.75], '101': [35.69, 139.77], '102': [35.68, 139.73],
                '103': [35.68, 139.77], '104': [35.67, 139.77], '105': [35.66, 139.75],
                '106': [35.66, 139.73], '107': [35.67, 139.73], '108': [35.65, 139.74],
                '110': [35.71, 139.79], '111': [35.72, 139.79], '112': [35.71, 139.75],
                '113': [35.70, 139.76], '114': [35.74, 139.72], '115': [35.74, 139.71],
                '116': [35.73, 139.71], '120': [35.75, 139.84], '121': [35.75, 139.86],
                '130': [35.66, 139.94], '140': [35.64, 139.65], '150': [35.66, 139.70],
                '151': [35.67, 139.70], '152': [35.63, 139.67], '153': [35.64, 139.67],
                '160': [35.69, 139.70], '161': [35.70, 139.71], '162': [35.70, 139.72],
                '170': [35.74, 139.72], '171': [35.73, 139.71], '180': [35.70, 139.56],
                // 神奈川
                '220': [35.47, 139.62], '221': [35.47, 139.62], '222': [35.52, 139.61],
                '230': [35.44, 139.64], '231': [35.44, 139.64], '240': [35.46, 139.62],
                '250': [35.32, 139.14], '251': [35.34, 139.53], '252': [35.56, 139.34],
                // 埼玉
                '330': [35.86, 139.65], '331': [35.91, 139.59], '332': [35.82, 139.71],
                '340': [35.92, 139.74], '350': [35.89, 139.49], '351': [35.98, 139.54],
                '352': [35.79, 139.59], '355': [36.04, 139.39],
                // 千葉
                '260': [35.61, 140.11], '261': [35.66, 140.03], '270': [35.84, 139.90],
                '271': [35.79, 139.98], '272': [35.72, 139.99], '273': [35.78, 139.99],
                // 愛知
                '440': [34.76, 137.39], '441': [34.76, 137.33], '442': [34.70, 137.73],
                '443': [34.81, 137.40], '444': [34.95, 137.18], '445': [34.80, 137.04],
                '446': [35.00, 137.04], '447': [34.83, 136.96], '448': [35.00, 137.16],
                '450': [35.17, 136.91], '451': [35.22, 136.94], '452': [35.25, 136.99],
                '453': [35.14, 136.85], '454': [35.17, 136.82], '455': [35.10, 136.83],
                '456': [35.13, 136.94], '457': [35.11, 137.06], '458': [35.09, 136.95],
                '460': [35.18, 136.91], '461': [35.20, 136.93], '462': [35.16, 136.93],
                '463': [35.25, 136.97], '464': [35.17, 136.97], '465': [35.26, 137.02],
                '466': [35.17, 137.06], '467': [35.13, 137.01], '468': [35.13, 137.10],
                '470': [35.08, 137.09], '471': [35.13, 137.19], '472': [35.02, 137.24],
                // 大阪
                '530': [34.70, 135.51], '531': [34.72, 135.51], '532': [34.73, 135.49],
                '540': [34.69, 135.52], '541': [34.70, 135.51], '542': [34.66, 135.50],
                '550': [34.66, 135.48], '551': [34.67, 135.48], '552': [34.65, 135.46],
                '560': [34.81, 135.51], '561': [34.83, 135.56], '562': [34.87, 135.54],
                '570': [34.69, 135.52], '571': [34.70, 135.60], '572': [34.71, 135.59],
                '580': [34.61, 135.48], '581': [34.67, 135.60], '590': [34.57, 135.49],
                // 兵庫
                '650': [34.69, 135.20], '651': [34.71, 135.16], '652': [34.70, 135.21],
                '660': [34.73, 135.47], '661': [34.74, 135.43], '670': [34.82, 134.69],
                // 京都
                '600': [34.99, 135.76], '601': [35.04, 135.73], '602': [35.03, 135.75],
                '610': [34.87, 135.82], '611': [34.88, 135.80], '612': [34.99, 135.81],
                // 福岡
                '800': [33.61, 130.42], '801': [33.60, 130.36], '802': [33.57, 130.48],
                '810': [33.59, 130.40], '811': [33.58, 130.36], '812': [33.59, 130.42],
                // 広島
                '720': [34.44, 133.23], '730': [34.40, 132.46], '731': [34.43, 132.47],
                '732': [34.38, 132.47], '733': [34.37, 132.35], '734': [34.34, 132.47],
            };
            
            // 3桁でマッチしない場合は2桁で検索
            if (!mapping[prefix]) {
                const prefix2 = postalCode.substring(0, 2);
                const mapping2 = {
                    '10': [35.68, 139.75], '11': [35.71, 139.77], '12': [35.73, 139.81],
                    '13': [35.66, 139.88], '14': [35.64, 139.65], '15': [35.66, 139.70],
                    '16': [35.69, 139.70], '17': [35.73, 139.71], '18': [35.70, 139.56],
                    '22': [35.47, 139.62], '23': [35.44, 139.64], '24': [35.46, 139.62],
                    '25': [35.34, 139.34], '26': [35.61, 140.11], '27': [35.79, 139.98],
                    '33': [35.86, 139.65], '34': [35.92, 139.74], '35': [35.89, 139.49],
                    '44': [34.88, 137.19], '45': [35.17, 136.91], '46': [35.18, 136.91],
                    '47': [35.08, 137.09], '48': [35.27, 137.11], '49': [35.20, 136.87],
                    '50': [35.47, 136.72], '51': [34.73, 136.51], '52': [35.00, 135.87],
                    '53': [34.70, 135.51], '54': [34.69, 135.52], '55': [34.66, 135.48],
                    '56': [34.81, 135.51], '57': [34.69, 135.52], '58': [34.61, 135.48],
                    '59': [34.57, 135.49], '60': [34.99, 135.76], '61': [34.88, 135.80],
                    '65': [34.69, 135.20], '66': [34.73, 135.42], '67': [34.82, 134.69],
                    '70': [34.66, 133.92], '72': [34.40, 133.20], '73': [34.40, 132.46],
                    '80': [33.61, 130.42], '81': [33.59, 130.40], '82': [33.56, 130.34],
                };
                if (mapping2[prefix2]) {
                    return { lat: mapping2[prefix2][0], lng: mapping2[prefix2][1] };
                }
            }
            
            return mapping[prefix] ? { lat: mapping[prefix][0], lng: mapping[prefix][1] } : { lat: 35.681, lng: 139.767 };
        };
        
        // 距離計算
        const calculateDistance = (lat1, lon1, lat2, lon2) => {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        };
        
        // メインコンポーネント
        const CampaignSearchApp = () => {
            const [stores, setStores] = useState([]);
            const [searchType, setSearchType] = useState('postal');
            const [searchRange, setSearchRange] = useState(10);
            const [searchResults, setSearchResults] = useState([]);
            const [isLoading, setIsLoading] = useState(false);
            const [postalCode, setPostalCode] = useState('');
            const [keyword, setKeyword] = useState('');
            const [showSparkle, setShowSparkle] = useState(true);
            const [error, setError] = useState('');
            const [showPulse, setShowPulse] = useState(false);
            const [dataLoading, setDataLoading] = useState(true);
            const [campaignOnly, setCampaignOnly] = useState(false);
            const [showTooltip, setShowTooltip] = useState(false);
            const postalInputRef = React.useRef(null);
            
            // GitHub Gistからデータを読み込み
            useEffect(() => {
                const loadData = async () => {
                    try {
                        const response = await fetch(GITHUB_GIST_URL);
                        if (!response.ok) {
                            throw new Error('データの読み込みに失敗しました');
                        }
                        const data = await response.json();
                        setStores(data);
                        setDataLoading(false);
                        console.log(`データ読み込み完了: ${data.length}店舗`);
                    } catch (error) {
                        console.error('データ読み込みエラー:', error);
                        setError('データの読み込みに失敗しました。URLを確認してください。');
                        setDataLoading(false);
                    }
                };
                
                if (GITHUB_GIST_URL.includes('YOUR_USERNAME')) {
                    setError('GitHub Gist URLが設定されていません。HTMLファイルを編集してURLを設定してください。');
                    setDataLoading(false);
                } else {
                    loadData();
                }
            }, []);
            
            // きらきらアニメーション
            useEffect(() => {
                const interval = setInterval(() => {
                    setShowSparkle(prev => !prev);
                }, 800);
                return () => clearInterval(interval);
            }, []);
            
            // 検索ボタンのパルス効果
            useEffect(() => {
                const interval = setInterval(() => {
                    setShowPulse(true);
                    setTimeout(() => setShowPulse(false), 1000);
                }, 10000);
                return () => clearInterval(interval);
            }, []);
            
            // 郵便番号入力フィールドへの自動フォーカス
            useEffect(() => {
                if (!dataLoading && searchType === 'postal' && postalInputRef.current) {
                    postalInputRef.current.focus();
                }
            }, [dataLoading, searchType]);
            useEffect(() => {
                const handleKeyPress = (e) => {
                    if (e.key === 'Enter' && !isLoading && stores.length > 0) {
                        handleSearch();
                    }
                };
                
                window.addEventListener('keypress', handleKeyPress);
                return () => window.removeEventListener('keypress', handleKeyPress);
            }, [searchType, postalCode, keyword, isLoading, stores.length]);
            
            // 現在地から検索
            const searchByLocation = async () => {
                setIsLoading(true);
                setError('');
                
                try {
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(
                            (position) => {
                                const userLat = position.coords.latitude;
                                const userLng = position.coords.longitude;
                                performLocationSearch(userLat, userLng);
                            },
                            (error) => {
                                console.log('位置情報取得エラー、東京駅を基準にします');
                                performLocationSearch(35.681, 139.767);
                            }
                        );
                    } else {
                        performLocationSearch(35.681, 139.767);
                    }
                } catch (error) {
                    console.error('検索エラー:', error);
                    setError('検索中にエラーが発生しました');
                    setIsLoading(false);
                }
            };
            
            // 位置情報を使った検索処理
            const performLocationSearch = (userLat, userLng) => {
                const storesWithDistance = stores.map(store => {
                    const storeLocation = getLatLngFromPostalCode(store['郵便番号'] || '');
                    const distance = calculateDistance(userLat, userLng, storeLocation.lat, storeLocation.lng);
                    return { ...store, distance };
                });
                
                const filtered = searchRange === 0 
                    ? storesWithDistance 
                    : storesWithDistance.filter(store => store.distance <= searchRange);
                
                const sorted = filtered.sort((a, b) => a.distance - b.distance).slice(0, 5);
                
                setSearchResults(sorted);
                setIsLoading(false);
            };
            
            // 郵便番号で検索
            const searchByPostalCode = async () => {
                if (!postalCode || postalCode.length < 7) {
                    alert('7桁の郵便番号を入力してください');
                    return;
                }
                
                setIsLoading(true);
                setError('');
                
                try {
                    const normalizedPostal = postalCode.replace(/[０-９]/g, s => 
                        String.fromCharCode(s.charCodeAt(0) - 0xFEE0)
                    ).replace(/[^0-9]/g, '');
                    
                    const userLocation = getLatLngFromPostalCode(normalizedPostal);
                    
                    const storesWithDistance = stores.map(store => {
                        const storeLocation = getLatLngFromPostalCode(store['郵便番号'] || '');
                        const distance = calculateDistance(userLocation.lat, userLocation.lng, storeLocation.lat, storeLocation.lng);
                        return { ...store, distance };
                    });
                    
                    const filtered = searchRange === 0 
                        ? storesWithDistance 
                        : storesWithDistance.filter(store => store.distance <= searchRange);
                    
                    const sorted = filtered.sort((a, b) => a.distance - b.distance).slice(0, 5);
                    
                    setSearchResults(sorted);
                    setIsLoading(false);
                } catch (error) {
                    console.error('検索エラー:', error);
                    setError('検索中にエラーが発生しました');
                    setIsLoading(false);
                }
            };
            
            // キーワードで検索
            const searchByKeyword = async () => {
                if (!keyword || keyword.length < 2) {
                    alert('2文字以上のキーワードを入力してください');
                    return;
                }
                
                setIsLoading(true);
                setError('');
                
                try {
                    const filtered = stores.filter(store => 
                        (store['店舗名'] || '').includes(keyword) || 
                        (store['住所'] || '').includes(keyword)
                    );
                    
                    const campaignStores = filtered.filter(store => store['キャンペーン実施店（1が実施店、空白は未実施店）'] === 1);
                    const nonCampaignStores = filtered.filter(store => store['キャンペーン実施店（1が実施店、空白は未実施店）'] !== 1);
                    
                    const results = [...campaignStores, ...nonCampaignStores].slice(0, 5);
                    
                    setSearchResults(results);
                    setIsLoading(false);
                } catch (error) {
                    console.error('検索エラー:', error);
                    setError('検索中にエラーが発生しました');
                    setIsLoading(false);
                }
            };
            
            const handleSearch = () => {
                switch (searchType) {
                    case 'location':
                        searchByLocation();
                        break;
                    case 'postal':
                        searchByPostalCode();
                        break;
                    case 'keyword':
                        searchByKeyword();
                        break;
                }
            };
            
            const getGoogleMapsUrl = (address) => {
                return `https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(address)}`;
            };
            
            // フィルター適用後の結果
            const filteredResults = campaignOnly 
                ? searchResults.filter(store => store['キャンペーン実施店（1が実施店、空白は未実施店）'] === 1)
                : searchResults;
            
            // データ読み込み中の画面
            if (dataLoading) {
                return (
                    <div className="min-h-screen bg-gray-50 flex items-center justify-center">
                        <div className="text-center">
                            <div className="w-16 h-16 border-4 border-pink-400 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                            <p className="text-lg text-gray-700">データを読み込んでいます...</p>
                        </div>
                    </div>
                );
            }
            
            return (
                <div className="min-h-screen bg-gray-50">
                    {/* ヘッダー */}
                    <header className="bg-white shadow-sm sticky top-0 z-50 border-b border-gray-100">
                        <div className="container mx-auto px-4 py-3">
                            <div className="text-center">
                                <h1 className="text-2xl font-bold text-gray-900 mb-1">ナチュリズム × Kep1er</h1>
                                <p className="text-2xl font-bold text-gray-900 mb-2">キャンペーン実施店舗検索</p>
                                <div className="flex items-center justify-center gap-2">
                                    <Icon name="sparkles" className={`w-4 h-4 text-yellow-400 transition-all duration-300 ${showSparkle ? 'scale-125 opacity-100' : 'scale-75 opacity-50'}`} />
                                    <p className="text-sm text-pink-600 font-medium">ドンキ限定！トレカが必ずもらえる！</p>
                                    <Icon name="sparkles" className={`w-4 h-4 text-yellow-400 transition-all duration-300 ${!showSparkle ? 'scale-125 opacity-100' : 'scale-75 opacity-50'}`} />
                                </div>
                            </div>
                        </div>
                    </header>
                    
                    {/* エラー表示 */}
                    {error && (
                        <div className="container mx-auto px-4 mt-4">
                            <div className="bg-red-100 text-red-700 p-3 rounded-lg text-sm max-w-4xl mx-auto fade-in-up">
                                {error}
                            </div>
                        </div>
                    )}
                    
                    {/* 検索セクション */}
                    <section className="py-6">
                        <div className="container mx-auto px-4">
                            <div className="bg-pink-50 rounded-xl shadow-lg p-6 max-w-4xl mx-auto">
                                {/* 検索タイプ選択 */}
                                <div className="grid grid-cols-3 gap-2 mb-6">
                                    <button
                                        onClick={() => setSearchType('postal')}
                                        onMouseEnter={(e) => {
                                            if (searchType !== 'postal') {
                                                e.currentTarget.style.transform = 'scale(1.05)';
                                                e.currentTarget.style.boxShadow = '0 10px 15px -3px rgba(0, 0, 0, 0.1)';
                                            }
                                        }}
                                        onMouseLeave={(e) => {
                                            if (searchType !== 'postal') {
                                                e.currentTarget.style.transform = 'scale(1)';
                                                e.currentTarget.style.boxShadow = '';
                                            }
                                        }}
                                        className={`flex items-center justify-center gap-2 p-4 rounded-lg transition-all duration-200 cursor-pointer border-2 ${
                                            searchType === 'postal' 
                                                ? 'bg-gradient-to-r from-gray-100 via-pink-200 to-pink-300 text-gray-700 shadow-md transform scale-105 border-pink-300' 
                                                : 'bg-gradient-to-r from-gray-100 to-gray-200 text-gray-700 border-pink-200'
                                        }`}
                                        style={{ transition: 'all 0.2s ease' }}
                                    >
                                        <span className="text-lg text-red-600 font-bold">〒</span>
                                        <span className="hidden sm:inline font-medium">郵便番号</span>
                                    </button>
                                    <button
                                        onClick={() => setSearchType('keyword')}
                                        onMouseEnter={(e) => {
                                            if (searchType !== 'keyword') {
                                                e.currentTarget.style.transform = 'scale(1.05)';
                                                e.currentTarget.style.boxShadow = '0 10px 15px -3px rgba(0, 0, 0, 0.1)';
                                            }
                                        }}
                                        onMouseLeave={(e) => {
                                            if (searchType !== 'keyword') {
                                                e.currentTarget.style.transform = 'scale(1)';
                                                e.currentTarget.style.boxShadow = '';
                                            }
                                        }}
                                        className={`flex items-center justify-center gap-2 p-4 rounded-lg transition-all duration-200 cursor-pointer border-2 ${
                                            searchType === 'keyword' 
                                                ? 'bg-gradient-to-r from-gray-100 via-pink-200 to-pink-300 text-gray-700 shadow-md transform scale-105 border-pink-300' 
                                                : 'bg-gradient-to-r from-gray-100 to-gray-200 text-gray-700 border-pink-200'
                                        }`}
                                        style={{ transition: 'all 0.2s ease' }}
                                    >
                                        <Icon name="search" className="w-5 h-5" />
                                        <span className="hidden sm:inline font-medium">キーワード</span>
                                    </button>
                                    <button
                                        onClick={() => setSearchType('location')}
                                        onMouseEnter={(e) => {
                                            if (searchType !== 'location') {
                                                e.currentTarget.style.transform = 'scale(1.05)';
                                                e.currentTarget.style.boxShadow = '0 10px 15px -3px rgba(0, 0, 0, 0.1)';
                                            }
                                        }}
                                        onMouseLeave={(e) => {
                                            if (searchType !== 'location') {
                                                e.currentTarget.style.transform = 'scale(1)';
                                                e.currentTarget.style.boxShadow = '';
                                            }
                                        }}
                                        className={`flex items-center justify-center gap-2 p-4 rounded-lg transition-all duration-200 cursor-pointer border-2 ${
                                            searchType === 'location' 
                                                ? 'bg-gradient-to-r from-gray-100 via-pink-200 to-pink-300 text-gray-700 shadow-md transform scale-105 border-pink-300' 
                                                : 'bg-gradient-to-r from-gray-100 to-gray-200 text-gray-700 border-pink-200'
                                        }`}
                                        style={{ transition: 'all 0.2s ease' }}
                                    >
                                        <Icon name="map-pin" className="w-5 h-5" />
                                        <span className="hidden sm:inline font-medium">現在地から</span>
                                    </button>
                                </div>
                                
                                {/* 入力エリア */}
                                <div className="mb-4">
                                    {searchType === 'postal' && (
                                        <input
                                            ref={postalInputRef}
                                            type="text"
                                            placeholder="例：1500042"
                                            value={postalCode}
                                            onChange={(e) => setPostalCode(e.target.value)}
                                            className="w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-pink-400 focus:outline-none transition-colors"
                                            maxLength="7"
                                        />
                                    )}
                                    {searchType === 'keyword' && (
                                        <input
                                            type="text"
                                            placeholder="店舗名や住所の一部を入力"
                                            value={keyword}
                                            onChange={(e) => setKeyword(e.target.value)}
                                            className="w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-pink-400 focus:outline-none transition-colors"
                                        />
                                    )}
                                    {searchType === 'location' && (
                                        <div>
                                            <p className="text-sm text-gray-600 text-center py-3">
                                                現在地情報の取得を試みます
                                            </p>
                                            <p className="text-xs text-gray-500 text-center">
                                                ※ 取得できない場合は東京駅を基準にします
                                            </p>
                                        </div>
                                    )}
                                </div>
                                
                                {/* 検索範囲 */}
                                <div className="mb-6">
                                    <label className="block text-sm font-medium text-gray-700 mb-2">検索範囲</label>
                                    <div className="flex gap-2 flex-wrap">
                                        {[5, 10, 20, 0].map(range => (
                                            <button
                                                key={range}
                                                onClick={() => setSearchRange(range)}
                                                onMouseEnter={(e) => {
                                                    if (searchRange !== range) {
                                                        e.currentTarget.style.transform = 'scale(1.05)';
                                                        e.currentTarget.style.boxShadow = '0 10px 15px -3px rgba(0, 0, 0, 0.1)';
                                                    }
                                                }}
                                                onMouseLeave={(e) => {
                                                    if (searchRange !== range) {
                                                        e.currentTarget.style.transform = 'scale(1)';
                                                        e.currentTarget.style.boxShadow = '';
                                                    }
                                                }}
                                                className={`px-4 py-2 rounded-full transition-all duration-200 cursor-pointer ${
                                                    searchRange === range 
                                                        ? 'bg-pink-500 text-white shadow-md transform scale-105' 
                                                        : 'bg-white text-gray-700 border border-gray-300'
                                                }`}
                                                style={{ transition: 'all 0.2s ease' }}
                                            >
                                                {range === 0 ? '無制限' : `${range}km`}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                
                                {/* 検索ボタン */}
                                <button
                                    onClick={handleSearch}
                                    disabled={isLoading || stores.length === 0}
                                    onMouseEnter={(e) => {
                                        if (!isLoading && stores.length > 0) {
                                            e.currentTarget.style.transform = 'scale(1.02)';
                                            e.currentTarget.style.boxShadow = '0 20px 25px -5px rgba(0, 0, 0, 0.1)';
                                        }
                                    }}
                                    onMouseLeave={(e) => {
                                        if (!isLoading && stores.length > 0) {
                                            e.currentTarget.style.transform = 'scale(1)';
                                            e.currentTarget.style.boxShadow = '0 10px 15px -3px rgba(0, 0, 0, 0.1)';
                                        }
                                    }}
                                    onMouseDown={(e) => {
                                        if (!isLoading && stores.length > 0) {
                                            e.currentTarget.style.transform = 'scale(0.98)';
                                        }
                                    }}
                                    onMouseUp={(e) => {
                                        if (!isLoading && stores.length > 0) {
                                            e.currentTarget.style.transform = 'scale(1.02)';
                                        }
                                    }}
                                    className={`w-full py-4 rounded-lg font-bold text-white transition-all duration-300 ${
                                        isLoading || stores.length === 0
                                            ? 'bg-gray-400 cursor-not-allowed' 
                                            : 'bg-gradient-to-r from-blue-500 to-pink-500 cursor-pointer shadow-lg'
                                    } ${showPulse && !isLoading ? 'animate-pulse' : ''}`}
                                    style={{ transition: 'all 0.2s ease' }}
                                >
                                    {isLoading ? (
                                        <div className="flex items-center justify-center gap-2">
                                            <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                                            <span>検索中...</span>
                                        </div>
                                    ) : stores.length === 0 ? (
                                        <span>データ読み込み中...</span>
                                    ) : (
                                        <span className="flex items-center justify-center gap-2">
                                            <Icon name="search" className="w-5 h-5" />
                                            検索する
                                        </span>
                                    )}
                                </button>
                            </div>
                        </div>
                    </section>
                    
                    {/* 検索結果 */}
                    {searchResults.length > 0 && (
                        <section className="py-6">
                            <div className="container mx-auto px-4">
                                <div className="bg-pink-50 rounded-xl shadow-lg p-6 max-w-4xl mx-auto">
                                    <div className="flex items-center justify-between mb-4">
                                        <h2 className="text-xl font-bold text-gray-900 flex items-center gap-2">
                                            <span>検索結果</span>
                                            <span className="inline-block px-3 py-1 bg-pink-500 text-white rounded-full text-sm">
                                                {filteredResults.length}件
                                            </span>
                                        </h2>
                                        <label className="flex items-center gap-2 cursor-pointer group relative">
                                            <input
                                                type="checkbox"
                                                checked={campaignOnly}
                                                onChange={(e) => setCampaignOnly(e.target.checked)}
                                                className="w-4 h-4 text-pink-600 bg-gray-100 border-gray-300 rounded focus:ring-pink-500 focus:ring-2"
                                            />
                                            <span 
                                                className="text-sm font-medium text-gray-700 group-hover:text-pink-600 transition-colors"
                                                onMouseEnter={() => setShowTooltip(true)}
                                                onMouseLeave={() => setShowTooltip(false)}
                                            >
                                                実施店舗だけ
                                            </span>
                                            {showTooltip && (
                                                <div className="absolute -top-8 left-0 bg-gray-800 text-white text-xs px-2 py-1 rounded whitespace-nowrap">
                                                    キャンペーン実施店舗のみ表示
                                                </div>
                                            )}
                                        </label>
                                    </div>
                                    
                                    {filteredResults.length === 0 ? (
                                        <div className="text-center py-8">
                                            <Icon name="info" className="w-12 h-12 text-gray-400 mx-auto mb-2" />
                                            <p className="text-gray-600">キャンペーン実施店舗が見つかりませんでした</p>
                                        </div>
                                    ) : (
                                        <div className="grid gap-4 md:grid-cols-2">
                                            {filteredResults.map((store, index) => (
                                                <div
                                                    key={store['No.']}
                                                    className="bg-white rounded-xl shadow-md hover:shadow-xl transition-all duration-300 transform hover:scale-[1.02] overflow-hidden cursor-pointer fade-in-up"
                                                    style={{ animationDelay: `${index * 0.2}s` }}
                                                >
                                                    <div className="p-5">
                                                        {/* 店舗名と距離 */}
                                                        <div className="flex justify-between items-start mb-3">
                                                            <div className="flex-1">
                                                                <h3 className="text-lg font-bold text-gray-900 mb-1">
                                                                    {store['店舗名']}
                                                                </h3>
                                                                <p className="text-sm text-gray-600">{store['住所']}</p>
                                                            </div>
                                                            {store.distance !== undefined && (
                                                                <div className="flex flex-col items-end gap-1">
                                                                    <div className="bg-cyan-100 text-cyan-800 px-3 py-1 rounded-full text-sm font-medium">
                                                                        {store.distance.toFixed(1)} km
                                                                    </div>
                                                                    {index === 0 && <span className="text-xs font-bold text-yellow-500 animate-bounce">Nearest☆</span>}
                                                                    {index === 1 && <span className="text-xs font-bold text-gray-500 animate-pulse">2nd</span>}
                                                                    {index === 2 && <span className="text-xs font-bold text-gray-400 animate-pulse">3rd</span>}
                                                                </div>
                                                            )}
                                                        </div>
                                                        
                                                        {/* キャンペーンステータス */}
                                                        <div className="mb-4">
                                                            {store['キャンペーン実施店（1が実施店、空白は未実施店）'] === 1 ? (
                                                                <div className="bg-gradient-to-r from-pink-100 to-yellow-100 rounded-lg p-3 text-center relative overflow-hidden">
                                                                    <div className="absolute inset-0 flex items-center justify-center opacity-10">
                                                                        <Icon name="sparkles" className="w-20 h-20 text-yellow-400 sparkle-animation" />
                                                                    </div>
                                                                    <p className="text-lg font-bold text-pink-600 mb-1 relative z-10" style={{ textShadow: '1px 1px 2px rgba(0,0,0,0.1)' }}>
                                                                        キャンペーン実施中
                                                                    </p>
                                                                    <div className="flex items-center justify-center gap-2 text-sm relative z-10">
                                                                        <Icon name="gift" className="w-4 h-4 text-pink-500" />
                                                                        <span className="text-gray-700">Kep1erトレカ・サイン入りトレカ</span>
                                                                        <Icon name="sparkles" className="w-4 h-4 text-yellow-400" />
                                                                    </div>
                                                                </div>
                                                            ) : (
                                                                <div className="bg-gray-100 rounded-lg p-3 text-center">
                                                                    <p className="text-gray-600">キャンペーン未実施店舗</p>
                                                                </div>
                                                            )}
                                                        </div>
                                                        
                                                        {/* 店舗情報 */}
                                                        <div className="space-y-2 text-sm">
                                                            <div className="flex items-center gap-2 text-gray-700">
                                                                <Icon name="clock" className="w-4 h-4" />
                                                                <span>{store['営業時間']}</span>
                                                            </div>
                                                            <div className="flex items-center gap-2 text-gray-700">
                                                                <Icon name="calendar" className="w-4 h-4" />
                                                                <span>定休日: {store['定休日']}</span>
                                                            </div>
                                                            <div className="flex items-center gap-2 text-gray-700">
                                                                <Icon name="phone" className="w-4 h-4" />
                                                                <span>{store['電話番号']}</span>
                                                            </div>
                                                            <div className="flex items-center gap-2 text-gray-700">
                                                                <Icon name="map-pin" className="w-4 h-4" />
                                                                <span>最寄り駅から徒歩圏内</span>
                                                            </div>
                                                        </div>
                                                        
                                                        {/* ルート案内ボタン */}
                                                        <a
                                                            href={getGoogleMapsUrl(store['住所'])}
                                                            target="_blank"
                                                            rel="noopener noreferrer"
                                                            onMouseEnter={(e) => {
                                                                e.currentTarget.style.transform = 'scale(1.05)';
                                                                e.currentTarget.style.boxShadow = '0 10px 15px -3px rgba(0, 0, 0, 0.1)';
                                                            }}
                                                            onMouseLeave={(e) => {
                                                                e.currentTarget.style.transform = 'scale(1)';
                                                                e.currentTarget.style.boxShadow = '';
                                                            }}
                                                            onMouseDown={(e) => {
                                                                e.currentTarget.style.transform = 'scale(0.95)';
                                                            }}
                                                            onMouseUp={(e) => {
                                                                e.currentTarget.style.transform = 'scale(1.05)';
                                                            }}
                                                            className="mt-4 w-full bg-gradient-to-r from-cyan-100 to-cyan-200 text-cyan-800 font-bold py-3 px-4 rounded-lg flex items-center justify-center gap-2 transition-all duration-300 transform"
                                                            style={{ 
                                                                backgroundColor: '#b2f5ea',
                                                                color: '#285e61',
                                                                transition: 'all 0.2s ease'
                                                            }}
                                                        >
                                                            <Icon name="navigation-2" className="w-5 h-5" />
                                                            ルートを見る
                                                        </a>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </section>
                    )}
                    
                    {/* フッター */}
                    <footer className="mt-12 bg-gradient-to-r from-purple-100 to-pink-100 py-8">
                        <div className="container mx-auto px-4 text-center">
                            <p className="text-sm text-gray-700 mb-2">
                                © 2025 naturism × Kep1er<br />
                                キャンペーン実施店舗検索システム
                            </p>
                            <p className="text-xs text-gray-600">
                                キャンペーン期間：2025年7月18日～（景品がなくなり次第終了）
                            </p>
                        </div>
                    </footer>
                </div>
            );
        };
        
        // アプリケーションをマウント
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CampaignSearchApp />);
    </script>
</body>
</html>
